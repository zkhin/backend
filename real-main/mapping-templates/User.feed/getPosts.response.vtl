#if ($ctx.error)
  $util.error($ctx.error.message, $ctx.error.type)
#end

## remove missing posts from result set (in process of being deleted?)
#set ($posts = [])
#foreach ($postId in $ctx.prev.result.items)
  #set ($index = $ctx.stash.postIdToIndex[$postId])
  #if (! $util.isNull($ctx.result.data.${dynamoTable}[$index]))
    #set ($post = $ctx.result.data.${dynamoTable}[$index])
    $util.qr($posts.add($post))
  #end
#end

$util.toJson({
  'nextToken': $ctx.prev.result.nextToken,
  'items': $posts
})
